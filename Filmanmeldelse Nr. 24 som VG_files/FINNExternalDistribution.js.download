!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.FINNExternalDistribution=n()}(this,function(){"use strict";function e(e,n,t){if("IntersectionObserver"in window){var i=new f(t,{proximity:n.offset,once:!0});e&&i.observe(e)}else t()}function n(e,n){function t(n){return n===e.contentWindow}function i(){e.parentNode.removeChild(e)}window.addEventListener("message",function(e){if(e.origin.indexOf("finn.no")>-1||e.origin.indexOf("localhost")>-1){var r=t(e.source),o="string"==typeof e.data?JSON.parse(e.data):null;r&&o&&(!0===o.match?n(null,o):!1===o.match&&(i(),n(new Error("no match"))))}})}function t(){if(window&&"crypto"in window&&"randomUUID"in crypto)return crypto.randomUUID()}function i(){if(window)return window.FINN=window.FINN||{PageLoadEventId:t()},window.FINN.PageLoadEventId}function r(e){for(var n in e)e.hasOwnProperty(n)&&!e[n]&&delete e[n];return e}var o=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),s=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},c=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},u=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},l=function(){function e(e,n){var t=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(t.push(a.value),!n||t.length!==n);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function e(n){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.proximity,a=void 0===r?0:r;o(this,e),this._callback=n,this._proximity=a,this._observables=[],this._observer=new IntersectionObserver(function(e){return t.handleObservations(e)},{rootMargin:a+"px",threshold:0})}return a(e,[{key:"handleObservations",value:function(e){var n=this;e.forEach(function(e){n.isEnteringViewport(e)&&n.handleObservation(e.target)})}},{key:"isEnteringViewport",value:function(e){return this.isInscreenByThreshold(e)}},{key:"isInscreenByThreshold",value:function(e){return e.isIntersecting&&e.intersectionRatio>=0}},{key:"handleObservation",value:function(e){this._callback(e),this.unobserve(e),this.disconnect()}},{key:"observe",value:function(e){this._observer.observe(e)}},{key:"unobserve",value:function(e){try{this._observer.unobserve(e)}catch(e){}}},{key:"disconnect",value:function(){this._observer.disconnect()}}]),e}(),d=!1,v=function(){function t(e){o(this,t),this.setupDefaults(e)}return a(t,[{key:"setupDefaults",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.postMessageImpl,r=void 0===i?n:i,o=t.inViewportImpl,a=void 0===o?e:o,s=t.inview,c=void 0===s||s,u=t.offset,l=void 0===u?200:u,f=t.remote,d=void 0===f?"https://www.finn.no/distribution-front/external/carousel":f,v=t.id,p=t.theme,h=void 0===p?"light":p;this.options={postMessageImpl:r,inViewportImpl:a,inview:c,offset:l,remote:d,id:v,theme:h}}},{key:"_extendOptions",value:function(e){this.options=s({},this.options,e)}},{key:"_init",value:function(e,n,t){this.options.postMessageImpl(n,function(i,r){r&&r.height&&(n.style.height=r.height+"px",e.style.height=r.height+"px"),t(i,r)})}},{key:"_validate",value:function(e,n){n()}},{key:"_isPreview",value:function(){return!1}},{key:"inject",value:function(e,n){var t=this,i=s({},this.options,e);this._validate(i,function(e){if(e)return n(e);var r=i.selector;if(r instanceof HTMLElement||(r=document.querySelector(i.selector)),!(r&&r instanceof HTMLElement))return n(new Error("no element found for selector "+i.selector));if(t._isPreview()&&!d&&(d=!0,r.scrollIntoView()),i.inview)i.inViewportImpl(r,{offset:i.offset},function(){var e=t._createFrame(i);r.appendChild(e),t._init(r,e,n)});else{var o=t._createFrame(i);r.appendChild(o),t._init(r,o,n)}})}},{key:"_getQueryParameters",value:function(){return document.location.search.replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]}},{key:"_getCMPData",value:function(){return{analytics:this._getSpecificPermission("analytics"),advertising:this._getSpecificPermission("advertising"),marketing:this._getSpecificPermission("marketing"),personalization:this._getSpecificPermission("personalisation")}}},{key:"_getSpecificPermission",value:function(e){var n=window._tcf_||{getPermissionSync:function(){return null}};if("function"!=typeof n.getPermissionSync)return null;switch(n.getPermissionSync("CMP:"+e)){case"1":return!0;case"0":return!1;default:return null}}},{key:"_createUrl",value:function(){return""}},{key:"_createFrame",value:function(e){var n=document.createElement("iframe");return n.style.display="block",n.style.width="1px",n.style.minWidth="100%",n.scrolling="no",n.style.height="100%",n.style.border="0px none",n.src=this._createUrl(e),n}}]),t}();return{Fixed:function(e){function n(e){o(this,n);var t=u(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.setup(e),t}return c(n,e),a(n,[{key:"setup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.distributionTypes,t=void 0===n?[]:n,i=e.rec,r=void 0!==i&&i,o=e.limit,a=void 0===o?100:o;this._extendOptions({distributionTypes:t,rec:r,limit:a})}},{key:"_isPreview",value:function(){return null!=this.options.finncode||null!=this._getQueryParameters().finncode}},{key:"_getArticleId",value:function(){var e=document.location.href,n=new RegExp("/i/([^/]+)"),t=e.match(n);return t?t[1]:null}},{key:"_createUrl",value:function(e){var n=e.channel,t=e.position,r=e.distributionTypes,o=e.rec,a=e.limit,s=e.remote,c=e.finncode,u=e.requireImage,f=void 0!==u&&u,d=e.id,v=e.theme,p=e.hashed_email,h=this._getQueryParameters(),y=this._getArticleId();c=c||Number(h.finncode)||void 0;var m=this._getCMPData(),g=/^[0-9a-zA-Z]+$/,w=h.variant&&h.variant.match(g)&&h.variant,b=r.join(","),_=i();if(c){var k=s+"/preview",P=new URLSearchParams({channel:n,finnkode:c.toString(),pos:t,theme:v});return w&&P.append("variant",w),k+"?"+P.toString()}d&&p?s=s.replace("/external/carousel","/"+encodeURIComponent(d)+"/"+encodeURIComponent(p)+"/external"):d?s=s.replace("/external/carousel","/"+encodeURIComponent(d)+"/external"):p&&(s=s.replace("/external/carousel","/"+encodeURIComponent(p)+"/external"));var I=new URLSearchParams({channel:n,pos:t,rec:o,limit:a,distribution:b,requireImage:f,theme:v}),O={articleId:y,variant:w,pageloadEventId:_,cmpAnalytics:m.analytics,cmpMarketing:m.marketing,cmpPersonalization:m.personalization,cmpAdvertising:m.advertising};return Object.entries(O).forEach(function(e){var n=l(e,2),t=n[0],i=n[1];i&&I.append(t,i)}),s+"?"+I.toString()}},{key:"_validate",value:function(e,n){if("function"!=typeof n)throw new Error("Callback function is required");return void 0===e.selector||"undefined"===e.selector||""===e.selector?n(new Error("missing or invalid selector")):void 0===e.channel||"undefined"===e.channel||""===e.channel?n(new Error("missing or invalid channel")):void 0===e.position||"undefined"===e.position||""===e.position?n(new Error("missing or invalid position")):void n()}}]),n}(v),Carousel:function(e){function n(e){o(this,n);var t=u(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.setup(e),t}return c(n,e),a(n,[{key:"setup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.carouselid;this._extendOptions({carouselid:n})}},{key:"_isPreview",value:function(){return null!=this.options.finncodes||null!=this._getQueryParameters().finncodes}},{key:"_createUrl",value:function(e){var n=e.channel,t=void 0===n?"":n,i=e.position,o=void 0===i?"":i,a=e.carouselid,s=void 0===a?"":a,c=e.rows,u=e.direction,l=void 0===u?"vertical":u,f=e.remote,d=e.finncodes,v=this._getQueryParameters();d=d||v.finncodes||"";var p={channel:t,position:o,carouselid:s,rows:c,finncodes:d,direction:l};return p=r(p),f+"?"+Object.keys(p).map(function(e){return e+"="+p[e]}).join("&")}},{key:"_validate",value:function(e,n){if("function"!=typeof n)throw new Error("Callback function is required");return void 0===e.selector||"undefined"===e.selector||""===e.selector?n(new Error("missing or invalid selector")):void 0===e.channel||"undefined"===e.channel||""===e.channel?n(new Error("missing or invalid channel")):void 0===e.position||"undefined"===e.position||""===e.position?n(new Error("missing or invalid position")):void 0===e.carouselid||"undefined"===e.carouselid||""===e.carouselid?n(new Error("missing or invalid carouselid")):void n()}}]),n}(v)}});
