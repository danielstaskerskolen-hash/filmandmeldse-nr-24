import{c as z,g as U}from"./chunk-K2R772RY.CMeI58Hb.js";import{w as V}from"./chunk-UINSU34X.CLKLpshZ.js";import{g as a,a as j,i as F,b as T,c as x,d as B,e as O}from"./utils.QN2ubkM0.js";import{t as A}from"./chunk-OZ7A7O7C.Dbb0_YrX.js";import{T as q}from"./PulseStore.DXizHLoS.js";import"./index.BTyekFtn.js";import"https://esm.vg.no/react@19.1.1/es2020/react.mjs";import"./chunk-PXWMJYNN.WLwigf80.js";import"./chunk-I46T4OFX.B134-YLO.js";import"./chunk-DYJRXRRB.BTmRn6zq.js";const L=t=>{const{pageType:r}=document.documentElement.dataset;if(document.querySelector("[data-track-disable-page-leave-tracking]")!==null)return;const n=r==="Article"?document.querySelector("article"):document.querySelector("main");t.addPageLeaveTracking(n||document.body,document.body,void 0,{objectResizable:!0})},R=(t,r,s)=>{const{id:n,name:o,pageType:e}=document.documentElement.dataset,i=async()=>{switch(e){case"Article":return s.trackViewArticle({object:{accessLevel:t.accessLevel,accessLevelName:t.accessLevelName,articleId:n??"unknown",authors:t.authors,category:t.category,group:t.group,name:o??"",page:{id:n??"",type:"Article",url:t.pageUrl},"spt:custom":t["spt:custom"],imageUrl:t.imageUrl,tags:t.tags,updated:t.updated,wordCount:t.wordCount}});case"SalesPoster":break;case"Frontpage":return s.trackViewFrontpage({object:{id:n??"unknown",name:o??"unknown",page:{id:n??"",type:"Frontpage",url:window.location.toString()}}});case"Listing":return s.trackViewListing({object:{id:n??"unknown",name:o??"unknown",page:{id:n??"",type:"Listing",url:window.location.toString()}}});default:return s.trackViewPage({object:{name:o??"unknown",pageId:n??"unknown"}})}};V().then(()=>i().finally(()=>{const c=z(window.location.toString());if(c!==window.location.search)try{window.history.replaceState({...window.history.state,utmTags:r},"",location.pathname+(c?`?${c}`:""))}catch{console.warn("history.replaceState will fail on dev, where we use base tag")}}).catch(c=>{console.error("Failed to track page view",c)})).catch(c=>console.error("Failed to activate prerendering",c)),window.addEventListener("pageshow",c=>{c.persisted&&i()})},$=(t,r)=>{const s=()=>{const e=document.querySelector("link[rel='canonical']");return e?e.getAttribute("href"):""},n=e=>{const i=e.closest("a");if(!i||!/^((?!sms:|tel:|mailto:|javascript:|#).)*$/.test(i.href))return;const c=new URL(i.href);let l=!1;const p=a("[data-track-element-type]",e,"trackElementType",!1),u=a("[data-track-id]",e,"trackId",!1),k=j({rawId:document.documentElement.dataset.id||"unknown",type:document.documentElement.dataset.pageType||"unknown",tracker:r});if(k&&!c.searchParams.has("utm_source")&&(c.searchParams.append("utm_source",k),l=!0),p&&!c.searchParams.has("utm_medium")&&(c.searchParams.append("utm_medium",p),l=!0),u&&!c.searchParams.has("utm_content")&&(c.searchParams.append("utm_content",u),l=!0),F(c)){const m=U(window.location.toString(),!0);for(const[y,g]of Object.entries(m)){if(y==="terms"){c.searchParams.set("utm_term",g);continue}c.searchParams.set(`utm_${y}`,g)}const d=s();d&&c.searchParams.set("r0",d);const w=m.url||document.referrer;c.searchParams.set("traffic_source",w),l=!0}l&&(i.href=c.toString())},o=(e,i=!1)=>{const c=e.composedPath(),l=m=>{for(const d of c){if(d instanceof Element&&d.matches(m))return d;if(d instanceof ShadowRoot)break}return null},p=m=>!!l(m),u=l("a");if(u&&!p("[data-track-no-utm]")&&n(u),i)return;const k=l("a, button, input, summary, label, [data-track-click]");k&&t(k,r)};document.addEventListener("click",o),document.addEventListener("mousedown",e=>o(e,!0)),document.addEventListener("auxclick",e=>{e.button===1&&o(e)})},I=new WeakMap,M=(t,r)=>new IntersectionObserver(s=>{s.forEach(n=>{const o=n.target;let e=I.get(o);if(e||(e={wasTracked:!1,accumulatedTime:0,lastStartTime:null,intervalId:null},I.set(o,e)),n.isIntersecting){if(e.wasTracked||(t(o),e.wasTracked=!0),e.intervalId==null){e.lastStartTime=performance.now();const i=window.setInterval(()=>{if(e.lastStartTime!=null){const c=performance.now()-e.lastStartTime,l=e.accumulatedTime+c;r.setAttribute("data-track-duration",String(Math.floor(l)))}},500);e.intervalId=i}}else if(e.intervalId!=null){if(clearInterval(e.intervalId),e.intervalId=null,e.lastStartTime!=null){const i=performance.now()-e.lastStartTime;e.accumulatedTime+=i}e.lastStartTime=null}})},{rootMargin:"0px",threshold:.5}),H=(t,r)=>t.computedStyleMap?t.computedStyleMap().get(r)?.toString():getComputedStyle(t).getPropertyValue(r);function J(t){class r extends HTMLElement{observer=M(t,this);connectedCallback(){this.observer.observe(this.trackElement())}disconnectedCallback(){this.observer.unobserve(this.trackElement())}trackElement(n=this.firstElementChild){if(!n||!(n instanceof HTMLElement))throw new Error("TrackElement must have a child element");return n.computedStyleMap?.().get("display")?.toString()==="contents"?this.trackElement(n.firstElementChild):H(n,"display")==="contents"?this.trackElement(n.firstElementChild):n}}return r}const W=(t,r)=>{const s=a("[data-track-name]",t,"trackName"),n=a("[data-track-id]",t,"trackId")||A(s||"");if(!n)return;const o=a("[data-track-target]",t,"trackTarget"),e=a("[data-track-target-type]",t,"trackTargetType"),i=a("[data-track-click-intent]",t,"trackClickIntent"),c=a("[data-track-duration]",t,"trackDuration",!0),l=a("[data-track-curate-context]",t,"trackCurateContext"),p=a("[data-track-bundle-position]",t,"trackBundlePosition",!0),u=a("[data-track-primary-position]",t,"trackPrimaryPosition",!0),k=a("[data-track-secondary-position]",t,"trackSecondaryPosition",!0),m=a("[data-track-position-name]",t,"trackPositionName"),d=a("[data-track-position-source]",t,"trackPositionSource"),w=a("[data-track-element-size]",t,"trackElementSize"),y=a("[data-track-image-url]",t,"trackImageUrl"),g=a("[data-track-layout-name]",t,"trackLayoutName"),E=a("[data-track-element-type]",t,"trackElementType"),S=a("[data-track-target-newsroom]",t,"trackTargetNewsroom"),P=a("[data-track-access-level]",t,"trackAccessLevel"),h=a("[data-track-access-level-name]",t,"trackAccessLevelName"),_={columnName:m,curateContext:l,positionInBundle:p,primaryPosition:u,secondaryPosition:k,source:d},b={elementSize:w,imageUrl:y,name:g};return r.trackClickUIElement({target:{accessLevel:x(P),accessLevelName:h||void 0,id:n,name:s||"unknown",newsroom:S,type:T(e),url:o||document.location.href},object:{duration:c,elementType:E||"Element",id:n,intent:i,...b?.name&&{layout:b},name:s||"unknown",position:m,placement:_,size:w}})},v=(t,r)=>{const s=a("[data-track-name]",t,"trackName"),n=a("[data-track-id]",t,"trackId")||A(s||"");if(!n)return;const o=a("[data-track-target]",t,"trackTarget"),e=a("[data-track-target-type]",t,"trackTargetType"),i=a("[data-track-curate-context]",t,"trackCurateContext"),c=a("[data-track-bundle-position]",t,"trackBundlePosition",!0),l=a("[data-track-primary-position]",t,"trackPrimaryPosition",!0),p=a("[data-track-secondary-position]",t,"trackSecondaryPosition",!0),u=a("[data-track-position-name]",t,"trackPositionName"),k=a("[data-track-position-source]",t,"trackPositionSource"),m=a("[data-track-element-size]",t,"trackElementSize"),d=a("[data-track-image-url]",t,"trackImageUrl"),w=a("[data-track-layout-name]",t,"trackLayoutName"),y=a("[data-track-element-type]",t,"trackElementType"),g=a("[data-track-target-newsroom]",t,"trackTargetNewsroom"),E=a("[data-track-access-level]",t,"trackAccessLevel"),S=a("[data-track-access-level-name]",t,"trackAccessLevelName"),P={columnName:u,curateContext:i,positionInBundle:c,primaryPosition:l,secondaryPosition:p,source:k},h={elementSize:m,imageUrl:d,name:w};return r.trackViewUIElement({object:{elementType:y||"Element",id:n,...h?.name&&{layout:h},name:s||"unknown",placement:P,size:m},target:{accessLevel:x(E),accessLevelName:S||void 0,id:n,name:s||"unknown",newsroom:g,type:T(e),url:o}})},f=q.get(),Z=U(window.location.toString(),!0),N=JSON.parse(document.getElementById("features")?.textContent||"[]"),C=JSON.parse(document.getElementById("article-pulse-data")?.textContent||""),G=window.location.host.includes("feature.sk8s.vg.no"),K=async()=>{const t=a("[data-release]",document.documentElement,"release"),r=await B()||[];if(N&&r.push(...N),C?.accessLevelName==="dynamic-paywall"){const o=document.cookie.split("; ").find(e=>e.startsWith("x_refid="))?.split("=")[1];o&&f.addExperiments([{id:"zephr-outcome",name:"Zephr outcome",platform:"zephr",variant:o}])}f.updateBaseEvent({deployTag:t||"vgno-dev",deployStage:G?"pre":"pro",metrics:O(),experiments:r});const s=J(o=>v(o,f));customElements.get("track-element")||customElements.define("track-element",s),R(C,Z,f),$(W,f);const n=()=>{document.querySelectorAll("[data-track-impression]:not(track-element)").forEach(e=>{M(c=>v(c,f),e).observe(e)})};/complete|interactive/.test(document.readyState)?(n(),L(f)):document.addEventListener("DOMContentLoaded",()=>{n(),L(f)})};K();
//# sourceMappingURL=TrackingDelegate.astro_astro_type_script_index_0_lang.Bow7b1Y4.js.map
